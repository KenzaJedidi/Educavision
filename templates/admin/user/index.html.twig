{% extends 'admin/layout.html.twig' %}

{% block title %}Users Management - Admin{% endblock %}

{% block admin_content %}
    <div class="db-breadcrumb">
        <h4 class="breadcrumb-title">Users Management</h4>
        <ul class="db-breadcrumb-list">
            <li><a href="{{ path('admin_user_index') }}"><i class="fa fa-home"></i>Home</a></li>
            <li>Users</li>
        </ul>
    </div>



    <div class="row">
        <div class="col-lg-12 m-b30">
            <div class="widget-box">
                <div class="wc-title">
                    <div class="d-flex align-items-center justify-content-between">
                        <h4>
                            {% if current_role == 'admin' %}
                                Administrators
                            {% elseif current_role == 'professeur' %}
                                Teachers
                            {% elseif current_role == 'etudiant' %}
                                Students
                            {% else %}
                                All Users
                            {% endif %}
                            {% if current_role %}
                                <a href="{{ path('admin_user_index') }}" class="btn btn-sm btn-outline-danger ml-2" style="font-size: 12px; padding: 2px 8px;">
                                    <i class="fa fa-times"></i> Clear Filter
                                </a>
                            {% endif %}
                        </h4>
                        <div class="d-flex align-items-center">
                            <form method="get" action="{{ path('admin_user_index') }}" class="mr-3">
                                <div class="input-group search-group">
                                    <input type="text" name="search" class="form-control" placeholder="Search users..." value="{{ search }}">
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="submit"><i class="fa fa-search"></i></button>
                                    </div>
                                </div>
                            </form>
                            <a href="{{ path('admin_user_new') }}" class="btn btn-primary">
                                <i class="fa fa-plus"></i> Add New User
                            </a>
                        </div>
                    </div>
                </div>
                <div class="widget-inner">
                    <div class="table-responsive">
                        <table class="table table-hover table-modern">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Registered</th>
                                    <th class="text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for utilisateur in utilisateurs %}
                                <tr>
                                    <td>{{ utilisateur.id }}</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <span class="avatar-char mr-2">{{ utilisateur.prenom|slice(0,1) }}{{ utilisateur.nom|slice(0,1) }}</span>
                                            <div>
                                                <strong>{{ utilisateur.prenom }} {{ utilisateur.nom }}</strong>
                                            </div>
                                        </div>
                                    </td>
                                    <td>{{ utilisateur.email }}</td>
                                    <td>
                                        {% if utilisateur.role == 'admin' %}
                                            <span class="badge badge-primary">Admin</span>
                                        {% elseif utilisateur.role == 'professeur' %}
                                            <span class="badge badge-info">Professeur</span>
                                        {% else %}
                                            <span class="badge badge-warning">Student</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if utilisateur.actif %}
                                            <span class="badge badge-success">Active</span>
                                        {% else %}
                                            <span class="badge badge-danger">Inactive</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ utilisateur.dateInscription ? utilisateur.dateInscription|date('d M Y') : '-' }}</td>
                                    <td class="text-right">
                                        <a href="{{ path('admin_user_show', {id: utilisateur.id}) }}" class="btn btn-action btn-view" title="View">
                                            <i class="fa fa-eye"></i>
                                        </a>
                                        <a href="{{ path('admin_user_edit', {id: utilisateur.id}) }}" class="btn btn-action btn-edit" title="Edit">
                                            <i class="fa fa-pencil"></i>
                                        </a>
                                        <a href="{{ path('admin_user_toggle', {id: utilisateur.id}) }}" class="btn btn-action btn-toggle-{{ utilisateur.actif ? 'off' : 'on' }}" title="{{ utilisateur.actif ? 'Deactivate' : 'Activate' }}">
                                            <i class="fa fa-{{ utilisateur.actif ? 'ban' : 'check' }}"></i>
                                        </a>
                                        <form method="post" action="{{ path('admin_user_delete', {id: utilisateur.id}) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this user?');">
                                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ utilisateur.id) }}">
                                            <button type="submit" class="btn btn-action btn-delete" title="Delete">
                                                <i class="fa fa-trash"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="7" class="text-center py-5">
                                        <div class="empty-state">
                                            <i class="fa fa-users" style="font-size: 48px; color: #e0e0e0; display: block; margin-bottom: 15px;"></i>
                                            <p class="text-muted">No users found{% if search %} for "{{ search }}"{% endif %}.</p>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                     <!-- Pagination Placeholder (Static for Layout Demo) -->
                    <div class="d-flex justify-content-between align-items-center mt-3">
                         <span class="text-muted small">Showing {{ utilisateurs|length }} users</span>
                        <nav aria-label="Page navigation">
                            <ul class="pagination pagination-sm justify-content-end mb-0">
                                <li class="page-item disabled"><a class="page-link" href="#" tabindex="-1">Previous</a></li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item"><a class="page-link" href="#">Next</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
