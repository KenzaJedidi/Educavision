{% extends 'admin/layout.html.twig' %}
{% block breadcrumb_title %}R√©clamation{% endblock %}
{% block breadcrumb_items %}
    <li><a href="{{ path('admin_dashboard') }}">Dashboard</a></li>
    <li>R√©clamation</li>
{% endblock %}
{% block body %}
    <h1>D√©tail de la R√©clamation</h1>
    <ul>
        <li>ID : {{ reclamation.id }}</li>
        <li>Nom : {{ reclamation.nom|e }}</li>
        <li>Pr√©nom : {{ reclamation.prenom|e }}</li>
        <li>Email : {{ reclamation.email|e }}</li>
        <li>R√¥le : {{ reclamation.role|capitalize }}</li>
        <li>Statut : {{ reclamation.status|capitalize }}</li>
        <li>Titre : {{ reclamation.titre|e }}</li>
        <li>Description : {{ reclamation.description|e }}</li>
        <li>Date : {{ reclamation.dateReclamation|date('d/m/Y H:i') }}</li>
    </ul>
    <hr>
    <div class="ia-analyse-card" style="max-width:600px;margin:auto;background:#f9f9fc;border-radius:16px;box-shadow:0 4px 16px rgba(0,0,0,0.08);padding:32px 24px 24px 24px;">
        <h2 style="text-align:center;color:#4b6cb7;font-weight:700;margin-bottom:24px;">
            <span style="font-size:2rem;vertical-align:middle;">ü§ñ</span> Analyse IA
        </h2>
        <div style="margin-top:32px;">
            <div style="background:#fff;border-radius:8px;padding:16px;margin-bottom:16px;box-shadow:0 2px 8px rgba(75,108,183,0.07);display:flex;align-items:center;">
                <span style="font-size:1.5rem;margin-right:12px;color:#4b6cb7;">üìù</span>
                <div>
                    <strong style="color:#4b6cb7;">R√©sum√© :</strong>
                    <span style="color:#222;font-weight:500;">{{ reclamation.resumeAuto ?: 'Non disponible' }}</span>
                </div>
            </div>
            <div style="background:#fff;border-radius:8px;padding:16px;margin-bottom:16px;box-shadow:0 2px 8px rgba(75,108,183,0.07);display:flex;align-items:center;">
                <span style="font-size:1.5rem;margin-right:12px;color:#ffb347;">üí¨</span>
                <div>
                    <strong style="color:#ffb347;">Sentiment :</strong>
                    <span style="color:#222;font-weight:500;">{{ reclamation.sentimentAuto ?: 'Non disponible' }}</span>
                </div>
            </div>
            <div style="background:#fff;border-radius:8px;padding:16px;box-shadow:0 2px 8px rgba(75,108,183,0.07);display:flex;align-items:center;">
                <span style="font-size:1.5rem;margin-right:12px;color:#43e97b;">‚è±Ô∏è</span>
                <div>
                    <strong style="color:#43e97b;">Temps de r√©solution pr√©dit :</strong>
                    <span style="color:#222;font-weight:500;">{{ reclamation.tempsResolutionAuto ?: 'Non disponible' }}</span>
                </div>
            </div>
        </div>
    </div>
    <div style="margin-top:32px;text-align:center;">
        <a href="{{ path('reclamation_edit', {'id': reclamation.id}) }}" style="margin-right:16px;color:#4b6cb7;font-weight:600;text-decoration:none;">Modifier</a>
        <a href="{{ path('reclamation_index') }}" style="color:#4b6cb7;font-weight:600;text-decoration:none;">Retour √† la liste</a>
    </div>
    <script src="/assets/js/functions.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const btn = document.getElementById('btn-analyse-ia');
        if (btn) {
            btn.addEventListener('click', function() {
                const description = `{{ reclamation.description|e }}`;
                // R√©sum√©
                fetch('/api/summarize', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({text: description})
                })
                .then(r => r.json())
                .then(data => {
                    document.querySelector('#ia-summary span').textContent = data.summary || 'Erreur';
                })
                .catch(() => {
                    document.querySelector('#ia-summary span').textContent = 'Erreur';
                });
                // Sentiment
                fetch('/api/sentiment', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({text: description})
                })
                .then(r => r.json())
                .then(data => {
                    document.querySelector('#ia-sentiment span').textContent = data.sentiment || 'Erreur';
                })
                .catch(() => {
                    document.querySelector('#ia-sentiment span').textContent = 'Erreur';
                });
                // Pr√©diction temps
                fetch('/api/predict-resolution-time', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({text: description})
                })
                .then(r => r.json())
                .then(data => {
                    document.querySelector('#ia-resolution span').textContent = data.resolution_time || 'Erreur';
                })
                .catch(() => {
                    document.querySelector('#ia-resolution span').textContent = 'Erreur';
                });
            });
        }
    });
    </script>
{% endblock %}
