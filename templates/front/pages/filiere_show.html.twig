{% extends 'front/base.html.twig' %}

{% block title %}{{ filiere.nom }} - EducaVision{% endblock %}

{% block body %}
<!-- Page Title -->
<div class="page-banner ovbl-dark" style="background-image:url({{ asset('front-assets/images/banner/filiere-detail.jpg') }});">
    <div class="container">
        <div class="page-banner-entry">
            <h1 class="text-white">{{ filiere.nom }}</h1>
        </div>
    </div>
</div>

<!-- Breadcrumb -->
<div class="breadcrumb-row">
    <div class="container">
        <ul class="list-inline">
            <li><a href="{{ path('front_home') }}">Accueil</a></li>
            <li><a href="{{ path('front_filieres') }}">Filières</a></li>
            <li>{{ filiere.nom }}</li>
        </ul>
    </div>
</div>

<!-- Content -->
<div class="content-block">
    <div class="section-area section-sp2">
        <div class="container">
            <div class="row">
                <!-- Colonne principale -->
                <div class="col-lg-8">
                    <div class="filiere-detail">
                        <div class="filiere-header mb-4">
                            {% if filiere.image %}
                                <img src="{{ asset('assets/images/filieres/' ~ filiere.image) }}" 
                                     alt="{{ filiere.nom }}" 
                                     class="img-fluid rounded"
                                     style="width: 100%; height: 400px; object-fit: cover;"
                                     onerror="this.src='{{ asset('front-assets/images/courses/pic1.jpg') }}'">
                            {% else %}
                                <img src="{{ asset('front-assets/images/courses/pic1.jpg') }}" 
                                     alt="{{ filiere.nom }}" 
                                     class="img-fluid rounded"
                                     style="width: 100%; height: 400px; object-fit: cover;">
                            {% endif %}
                        </div>

                        <div class="filiere-content">
                            <h2 class="mb-3">{{ filiere.nom }}</h2>
                            
                            <div class="filiere-meta mb-4">
                                {% if filiere.responsable %}
                                    <span class="badge badge-primary mr-2">
                                        <i class="fa fa-user"></i> Responsable: {{ filiere.responsable }}
                                    </span>
                                {% endif %}
                                
                                <span class="badge badge-info">
                                    <i class="fa fa-calendar"></i> Créée le: {{ filiere.dateCreation|date('d/m/Y') }}
                                </span>
                            </div>

                            <div class="filiere-description mb-5">
                                <h4 class="mb-3">Description</h4>
                                <div class="description-content">
                                    {{ filiere.description|raw }}
                                </div>
                            </div>

                            {% if filiere.metiers|length > 0 %}
                            <div class="filiere-metiers mb-5">
                                <h4 class="mb-3">Métiers associés ({{ filiere.metiers|length }})</h4>
                                <div class="row">
                                    {% for metier in filiere.metiers %}
                                    <div class="col-md-6 mb-3">
                                        <div class="metier-card p-3 border rounded">
                                            <h5>{{ metier.nom }}</h5>
                                            <p class="text-muted mb-0">{{ metier.description|slice(0, 100) }}...</p>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="col-lg-4">
                    <div class="filiere-sidebar">
                        <div class="sidebar-widget mb-4">
                            <div class="widget-box bg-light p-4 rounded">
                                <h4 class="mb-3">Informations de la filière</h4>
                                
                                <ul class="list-unstyled">
                                    {% if filiere.responsable %}
                                    <li class="mb-3">
                                        <i class="fa fa-user text-primary mr-2"></i>
                                        <strong>Responsable:</strong> {{ filiere.responsable }}
                                    </li>
                                    {% endif %}
                                    
                                    <li class="mb-3">
                                        <i class="fa fa-calendar text-primary mr-2"></i>
                                        <strong>Créée le:</strong> {{ filiere.dateCreation|date('d/m/Y') }}
                                    </li>
                                    
                                    <li class="mb-3">
                                        <i class="fa fa-briefcase text-primary mr-2"></i>
                                        <strong>Métiers:</strong> {{ filiere.metiers|length }}
                                    </li>
                                </ul>
                                
                                <div class="mt-4">
                                    <a href="{{ path('front_contact') }}" class="btn btn-primary btn-block">
                                        <i class="fa fa-envelope"></i> Contacter le responsable
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="sidebar-widget mb-4">
                            <div class="widget-box bg-light p-4 rounded">
                                <h4 class="mb-3">Autres filières</h4>
                                {% set otherFilieres = [] %}
                                {% for other in allFilieres %}
                                    {% if other.id != filiere.id %}
                                        {% set otherFilieres = otherFilieres|merge([other]) %}
                                    {% endif %}
                                {% endfor %}
                                
                                {% if otherFilieres|length > 0 %}
                                    {% for other in otherFilieres|slice(0, 3) %}
                                    <div class="other-filiere mb-3">
                                        <h6>
                                            <a href="{{ path('front_filiere_show', {'id': other.id}) }}">
                                                {{ other.nom }}
                                            </a>
                                        </h6>
                                        <small class="text-muted">
                                            {{ other.metiers|length }} métiers
                                        </small>
                                    </div>
                                    {% endfor %}
                                {% else %}
                                    <p class="text-muted">Aucune autre filière pour le moment.</p>
                                {% endif %}
                            </div>
                        </div>

                        <div class="sidebar-widget">
                            <div class="widget-box bg-primary text-white p-4 rounded">
                                <h4 class="mb-3">Guide d'orientation</h4>
                                <p>Besoin d'aide pour choisir votre filière ?</p>
                                <a href="{{ path('front_contact') }}" class="btn btn-light btn-block">
                                    <i class="fa fa-comments"></i> Demander un conseil
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.filiere-detail {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.filiere-sidebar .widget-box {
    border: 1px solid #eee;
}

.filiere-content h2 {
    color: #333;
    border-bottom: 2px solid #007bff;
    padding-bottom: 10px;
}

.description-content {
    line-height: 1.8;
    color: #555;
}

.metier-card {
    transition: all 0.3s ease;
}

.metier-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.other-filiere {
    padding-bottom: 15px;
    border-bottom: 1px solid #eee;
}

.other-filiere:last-child {
    border-bottom: none;
}

.other-filiere h6 a {
    color: #333;
    text-decoration: none;
}

.other-filiere h6 a:hover {
    color: #007bff;
}

.badge-primary { background-color: #007bff; }
.badge-info { background-color: #17a2b8; }
</style>
{% endblock %}