{% extends 'admin/layout.html.twig' %}

{% block title %}Gestion des Utilisateurs - Admin{% endblock %}

{% block breadcrumb_title %}Gestion des Utilisateurs{% endblock %}
{% block breadcrumb_items %}<li>Utilisateurs</li>{% endblock %}

{% block body %}
    <div class="row">
        <div class="col-lg-12 m-b30">
            <div class="widget-box">
                <div class="wc-title">
                    <div class="d-flex align-items-center justify-content-between">
                        <h4>
                            {% if current_role == 'admin' %}
                                Administrateurs
                            {% elseif current_role == 'professeur' %}
                                Professeurs
                            {% elseif current_role == 'etudiant' %}
                                Étudiants
                            {% else %}
                                Tous les Utilisateurs
                            {% endif %}
                            {% if current_role %}
                                <a href="{{ path('admin_user_index') }}" class="btn btn-sm btn-outline-danger ml-2" style="font-size: 12px; padding: 2px 8px;">
                                    <i class="fa fa-times"></i> Effacer le filtre
                                </a>
                            {% endif %}
                        </h4>
                        <div class="d-flex align-items-center">
                            <form method="get" action="{{ path('admin_user_index') }}" class="mr-3">
                                <div class="input-group">
                                    <input type="text" name="search" class="form-control" placeholder="Rechercher..." value="{{ search }}">
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="submit"><i class="fa fa-search"></i></button>
                                    </div>
                                </div>
                            </form>
                            <a href="{{ path('admin_user_new') }}" class="btn btn-primary">
                                <i class="fa fa-plus"></i> Ajouter
                            </a>
                        </div>
                    </div>
                </div>
                <div class="widget-inner">
                    <!-- Role filter pills -->
                    <div class="mb-3">
                        <a href="{{ path('admin_user_index') }}" class="btn btn-sm {{ not current_role ? 'btn-primary' : 'btn-outline-secondary' }} mr-1">Tous</a>
                        <a href="{{ path('admin_user_index', {role: 'admin'}) }}" class="btn btn-sm {{ current_role == 'admin' ? 'btn-primary' : 'btn-outline-secondary' }} mr-1">Admins</a>
                        <a href="{{ path('admin_user_index', {role: 'professeur'}) }}" class="btn btn-sm {{ current_role == 'professeur' ? 'btn-info' : 'btn-outline-secondary' }} mr-1">Professeurs</a>
                        <a href="{{ path('admin_user_index', {role: 'etudiant'}) }}" class="btn btn-sm {{ current_role == 'etudiant' ? 'btn-warning' : 'btn-outline-secondary' }}">Étudiants</a>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>Rôle</th>
                                    <th>Statut</th>
                                    <th>Inscription</th>
                                    <th class="text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for utilisateur in utilisateurs %}
                                <tr>
                                    <td>{{ utilisateur.id }}</td>
                                    <td>
                                        <strong>{{ utilisateur.prenom }} {{ utilisateur.nom }}</strong>
                                    </td>
                                    <td>{{ utilisateur.email }}</td>
                                    <td>
                                        {% if utilisateur.role == 'admin' %}
                                            <span class="badge badge-primary">Admin</span>
                                        {% elseif utilisateur.role == 'professeur' %}
                                            <span class="badge badge-info">Professeur</span>
                                        {% else %}
                                            <span class="badge badge-warning">Étudiant</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if utilisateur.actif %}
                                            <span class="badge badge-success">Actif</span>
                                        {% else %}
                                            <span class="badge badge-danger">Inactif</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ utilisateur.dateInscription ? utilisateur.dateInscription|date('d/m/Y') : '-' }}</td>
                                    <td class="text-right">
                                        <a href="{{ path('admin_user_show', {id: utilisateur.id}) }}" class="btn btn-sm btn-outline-info" title="Voir">
                                            <i class="fa fa-eye"></i>
                                        </a>
                                        <a href="{{ path('admin_user_edit', {id: utilisateur.id}) }}" class="btn btn-sm btn-outline-primary" title="Modifier">
                                            <i class="fa fa-pencil"></i>
                                        </a>
                                        <a href="{{ path('admin_user_toggle', {id: utilisateur.id}) }}" class="btn btn-sm btn-outline-{{ utilisateur.actif ? 'warning' : 'success' }}" title="{{ utilisateur.actif ? 'Désactiver' : 'Activer' }}">
                                            <i class="fa fa-{{ utilisateur.actif ? 'ban' : 'check' }}"></i>
                                        </a>
                                        <form method="post" action="{{ path('admin_user_delete', {id: utilisateur.id}) }}" style="display:inline;" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?');">
                                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ utilisateur.id) }}">
                                            <button type="submit" class="btn btn-sm btn-outline-danger" title="Supprimer">
                                                <i class="fa fa-trash"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="7" class="text-center py-5">
                                        <i class="fa fa-users" style="font-size: 48px; color: #e0e0e0; display: block; margin-bottom: 15px;"></i>
                                        <p class="text-muted">Aucun utilisateur trouvé{% if search %} pour "{{ search }}"{% endif %}.</p>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <span class="text-muted small">{{ utilisateurs|length }} utilisateur(s) trouvé(s)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
